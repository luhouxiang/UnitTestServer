<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <title>协议测试</title>
	<link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script>
		$.ajaxSetup({
			data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
		  });
	</script>
</head>
<style type="text/css">
    .mypanel .panel-heading{}
    .mypanel{position: relative;display: none;}
    .opr-btn{position: absolute;right: 200px;}
    .navbar-btn{margin-top:2px;margin-bottom:8px;}
</style>
<body>

<div id="panel-box">
<div class="panel panel-default mypanel">
    <span class="opr-btn">
        <button type="button" class="btn btn-default navbar-btn" onclick="btn_add()">+</button>
        <button type="button" class="btn btn-default navbar-btn" onclick="btn_sub(this)">-</button>
    </span>
	<div class="panel-heading">
			标题
	</div>
	<div class="panel-body" style="padding-top:1px;">
		<nav class="navbar navbar-default" >
			<div class="container-fluid" style="padding-left:0px;padding-bottom:0px;">
		        <div class="navbar-form navbar-left" style="padding-left: 0px;">

					<ul class="nav navbar-nav">
						<li class="dropdown" style="width:82px;"><a href="#" class="dropdown-toggle" data-toggle="dropdown" ><span class="rec_option">GET</span> <b class="caret"></b></a>
							<ul class="dropdown-menu selectBox">
								<li><a id="action-get" href="#">GET</a></li>
								<li class="divider"></li>
								<li><a id="action-post" href="#">POST</a></li>
							</ul>
						</li>
					</ul>

		            <div class="form-group">

		                <input type="text" id="inputurl" class="inputurl" placeholder="Enter request URL" style="width: 626px;margin-top:11px;">
		                <button type="button" id="send_btn" class="btn btn-default" onclick="btn_send(this)" style="margin-top:0px;">Send</button>
		            </div>

		        </div>
			</div>
			<div id="collapseFour" class="panel-collapse collapse">
				<div class="panel-body" style="padding-top:0px;padding-left:0px; padding-bottom:0px">
					<textarea rows="10" cols="150" id="myPostData" class="myPostData" style="margin: 0px 0px 0px; width: 913px; height: 100px;"></textarea>
				</div>
			</div>
		</nav>
		Response
		<nav class="navbar navbar-default">
			<div class="container-fluid" style="padding-left: 0px;">
			    <textarea rows="10" cols="150" id="myResponse" class="myResponse" style="margin: 0px 0px 0px; width: 913px; height: 100px;"></textarea>
			</div>
		</nav>
	</div>
</div>
	</div>

<script type="text/javascript">
    var Dict = {{ Dict|safe }};
    console.log("--- 两种字典的取值方式  ---")
    console.log(Dict['requests']);
    console.log(Dict['folders']);
	(function(){
	    /*初加载*/
        // btn_add_login();
        // btn_add_ipo_cx();
        // btn_add_yuyue_cx();
        // btn_add_dxjl_cx();
        var request_list = Dict['requests'];
        for(var i=0; i<request_list.length; i++){
            console.log("url: ", request_list[i].url);//注意，此处 i 为键值
            console.log("method: ", request_list[i].method);
            console.log("name: ", request_list[i].name);
            console.log("data: ", request_list[i].rawModeData);

            var name = request_list[i].name;
            var url = request_list[i].url;
            var method = request_list[i].method;
            var data = request_list[i].rawModeData;
            console.log("---------------------------------------------------------");
            btn_add_list(name, url, method, data);
        }
	})();
	/*添加一个panel*/


    let fun_login = btn_login;
    function btn_add_login(){
       var $panel_clone = $('#panel-box>:first').clone(true);
        $panel_clone.show();
        $panel_clone.children('.panel-heading').text('登录');
        $panel_clone.find('.rec_option').text('POST');

        $panel_clone.find('#inputurl').val('https://192.168.5.252:31900/api/trade/ptjy/ptyw/login');
        $panel_clone.find('#inputurl').next().unbind('click');
        var $post_data = "{\n" +
            "\t\"khbzlx\":\"Z\",\n" +
            "\t\"khbz\":\"310800046832\",\n" +
            "\t\"jymm\":\"123123\",\n" +
            "\t\"sessionid\":\"0\",\n" +
            "\t\"yybdm\":\"1015\",\n" +
            "\t\"token\":\"0\",\n" +
            "\t\"lhxx\":\"123\",\n" +
            "\t\"rzfs\":\"1\",\n" +
            "\t\"rzxx\":\"\",\n" +
            "\t\"rznr\":\"\"\n" +
            "}";
        $panel_clone.find(".collapse").collapse('show').find('#myPostData').text($post_data);
        //第二步：在这里替换属性
        $panel_clone.find('#send_btn').attr('onclick',"fun_login(this)").text('login')
        var $f_box  = $('#panel-box');
        $f_box.append($panel_clone);
    }

    let fun_send = btn_send;

    function btn_add_list(name, url, method, data){
       var $panel_clone = $('#panel-box>:first').clone(true);
        $panel_clone.show();
        $panel_clone.children('.panel-heading').text(name);
        $panel_clone.find('.rec_option').text(method);

        $panel_clone.find('#inputurl').val(url);
        $panel_clone.find('#inputurl').next().unbind('click');
        var $post_data = data;
        $panel_clone.find(".collapse").collapse('show').find('#myPostData').text($post_data);
        //第二步：在这里替换属性
        $panel_clone.find('#send_btn').attr('onclick',"fun_send(this)").text('查询')
        var $f_box  = $('#panel-box');
        $f_box.append($panel_clone);
    }



    // 我的预约打新查询
    function btn_add_yuyue_cx(){
       var $panel_clone = $('#panel-box>:first').clone(true);
        $panel_clone.show();
        $panel_clone.children('.panel-heading').text('我的预约打新查询');
        $panel_clone.find('.rec_option').text('POST');

        $panel_clone.find('#inputurl').val('https://192.168.5.252:31900/api/autotrade/query');
        $panel_clone.find('#inputurl').next().unbind('click')
        var $post_data = "{\n" +
            "\t\"identifier\" : \"101500000060\",\n" +
            "\t\"serviceId\" : \"8001\",\n" +
            "\t\"type\":\"1\"\n" +
            "}";
        $panel_clone.find(".collapse").collapse('show').find('#myPostData').text($post_data);
        //第二步：在这里替换属性
        $panel_clone.find('#send_btn').attr('onclick',"fun_send(this)").text('查询')
        var $f_box  = $('#panel-box');
        $f_box.append($panel_clone);
    }

      // 我的打新记录查询
    function btn_add_dxjl_cx(){
       var $panel_clone = $('#panel-box>:first').clone(true);
        $panel_clone.show();
        $panel_clone.children('.panel-heading').text('我的打新记录查询');
        $panel_clone.find('.rec_option').text('POST');

        $panel_clone.find('#inputurl').val('https://192.168.5.252:31900/api/autotrade/query');
        $panel_clone.find('#inputurl').next().unbind('click')
        var $post_data = "{\n" +
            "\t\"identifier\" : \"101500000060\",\n" +
            "\t\"serviceId\" : \"8001\",\n" +
            "\t\"type\":\"0\"\n" +
            "}";
        $panel_clone.find(".collapse").collapse('show').find('#myPostData').text($post_data);
        //第二步：在这里替换属性
        $panel_clone.find('#send_btn').attr('onclick',"fun_send(this)").text('查询')
        var $f_box  = $('#panel-box');
        $f_box.append($panel_clone);
    }

    // 新股IPO查询
    function btn_add_ipo_cx(){
       var $panel_clone = $('#panel-box>:first').clone(true);
        $panel_clone.show();
        $panel_clone.children('.panel-heading').text('新股IPO查询');
        $panel_clone.find('.rec_option').text('POST');

        $panel_clone.find('#inputurl').val('https://192.168.5.252:31900/api/autotrade/query/ipo');
        $panel_clone.find('#inputurl').next().unbind('click')
        var $post_data = "{\n" +
            "\t\"identifier\" : \"101500000010\",\n" +
            "\t\"serviceId\" : \"8001\"\n" +
            "}";
        $panel_clone.find(".collapse").collapse('show').find('#myPostData').text($post_data);
        //第二步：在这里替换属性
        $panel_clone.find('#send_btn').attr('onclick',"fun_send(this)").text('查询')
        var $f_box  = $('#panel-box');
        $f_box.append($panel_clone);
    }



    // 登录
	function btn_login(dom) {
		// alert("abc");
		var $this = $(dom);
		var $p5 = $this.parent().parent().parent().parent().parent();
		var method = $p5.find(".rec_option").text();
		var inputurl = $p5.find(".inputurl").val();
		var postdata = $p5.find(".myPostData").val();
		var responsedata = $p5.find(".myResponse");
		$.post('/login/', {'inputurl': inputurl, 'method':method, 'postdata':postdata}, function(res){
			responsedata.val(res);
		});
	}


	// 发送get或post数据，传入底层统一用get
	function btn_send(dom) {
		var $this = $(dom);
        console.log($this.text())
		var $p5 = $this.parent().parent().parent().parent().parent();
		var method = $p5.find(".rec_option").text();
		var inputurl = $p5.find(".inputurl").val();
		var postdata = $p5.find(".myPostData").val();
		var responsedata = $p5.find(".myResponse");
		$.post('/send/', {'inputurl': inputurl, 'method':method, 'postdata':postdata}, function(res){
			responsedata.val(res);
		});
	}

	$(".selectBox").click(function(e){
        var tagName = e.target.tagName;
    	var $this = $(e.target);
    	if(tagName == 'A') {
    		// 根据选择重写菜单栏
    		e.preventDefault();
    		var rec_option = $this.text();
    		var $show_dom = $(this).prev().find(".rec_option");
    		$show_dom.text(rec_option);

    		// 根据选择的是否为POST决定是否显示PostData输入项
    		var myparent = $(this).closest('.mypanel');
    		if($this.text() == "GET") {
                myparent.children('.panel-heading').html('此处GET自定义标题');
                myparent.find('#inputurl').val('此处GET自定义url')
    			myparent.find(".collapse").collapse('hide');
    		}
    		else {
                myparent.children('.panel-heading').html('此处POST自定义标题');
                myparent.find('#inputurl').val('此处POST自定义url')
    			myparent.find(".collapse").collapse('show').find('#myPostData').text('post发送时预先加载的数据');
    		}
    	}
    });

</script>
</body>
</html>
